// Autogenerated from runtime/texts/markup_grammar.i

package ideal.runtime.texts;

import ideal.library.elements.*;
import ideal.library.characters.*;
import ideal.library.texts.*;
import ideal.runtime.elements.*;
import ideal.library.channels.output;
import ideal.library.patterns.*;
import ideal.runtime.patterns.*;

public class markup_grammar {
  public final character_handler the_character_handler;
  public final pattern<Character> document_pattern;
  public markup_grammar(final character_handler the_character_handler) {
    this.the_character_handler = the_character_handler;
    this.document_pattern = this.document();
  }
  protected boolean name_start(final char c) {
    return this.the_character_handler.is_letter(c) || c == '_' || c == ':';
  }
  protected boolean name_char(final char c) {
    return this.the_character_handler.is_letter(c) || c == '.' || c == '-' || c == '_' || c == ':';
  }
  protected boolean content_char(final char c) {
    return c != '<' && c != '&';
  }
  protected pattern<Character> one(final function1<Boolean, Character> the_predicate) {
    return new predicate_pattern<Character>(the_predicate);
  }
  protected pattern<Character> one_char(final char the_character) {
    return new singleton_pattern<Character>(the_character);
  }
  protected pattern<Character> zero_or_more(final function1<Boolean, Character> the_predicate) {
    return new repeat_pattern<Character>(the_predicate, true);
  }
  protected string as_string_procedure(final readonly_list<Character> the_character_list) {
    return (base_string) the_character_list.frozen_copy();
  }
  protected matcher<Character, string> as_string(final pattern<Character> the_pattern) {
    return new procedure_matcher<Character, string>(the_pattern, new function1<string, readonly_list<Character>>() {
      @Override public string call(readonly_list<Character> first) {
        return markup_grammar.this.as_string_procedure(first);
      }
    });
  }
  protected pattern<Character> space_opt() {
    return this.zero_or_more(new function1<Boolean, Character>() {
      @Override public Boolean call(Character first) {
        return markup_grammar.this.the_character_handler.is_whitespace(first);
      }
    });
  }
  protected matcher<Character, string> name() {
    return this.as_string(new sequence_pattern<Character>(new base_immutable_list<pattern<Character>>(new ideal.machine.elements.array<pattern<Character>>(new pattern[]{ this.one(new function1<Boolean, Character>() {
      @Override public Boolean call(Character first) {
        return markup_grammar.this.name_start(first);
      }
    }), this.zero_or_more(new function1<Boolean, Character>() {
      @Override public Boolean call(Character first) {
        return markup_grammar.this.name_char(first);
      }
    }) }))));
  }
  protected string select_2nd(final readonly_list<any_value> the_list) {
    return (string) the_list.get(1);
  }
  protected pattern<Character> lt() {
    return this.one_char('<');
  }
  protected pattern<Character> gt() {
    return this.one_char('>');
  }
  protected pattern<Character> slash() {
    return this.one_char('/');
  }
  protected pattern<Character> start_tag() {
    return new sequence_pattern<Character>(new base_immutable_list<pattern<Character>>(new ideal.machine.elements.array<pattern<Character>>(new pattern[]{ this.lt(), this.name(), this.space_opt(), this.gt() })));
  }
  protected pattern<Character> end_tag() {
    return new sequence_pattern<Character>(new base_immutable_list<pattern<Character>>(new ideal.machine.elements.array<pattern<Character>>(new pattern[]{ this.lt(), this.slash(), this.name(), this.space_opt(), this.gt() })));
  }
  protected pattern<Character> char_data() {
    return this.zero_or_more(new function1<Boolean, Character>() {
      @Override public Boolean call(Character first) {
        return markup_grammar.this.content_char(first);
      }
    });
  }
  protected pattern<Character> content() {
    return this.char_data();
  }
  protected pattern<Character> element() {
    return new sequence_pattern<Character>(new base_immutable_list<pattern<Character>>(new ideal.machine.elements.array<pattern<Character>>(new pattern[]{ this.start_tag(), this.content(), this.end_tag() })));
  }
  protected pattern<Character> document() {
    return new sequence_pattern<Character>(new base_immutable_list<pattern<Character>>(new ideal.machine.elements.array<pattern<Character>>(new pattern[]{ this.space_opt(), this.element(), this.space_opt() })));
  }
}
